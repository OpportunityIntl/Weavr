/* OI-Modals v0.10.2 
 * Copyright (c) 2016 Opportunity International 
 */
!function(a){a.lightbox=function(a,c){return new b(a,c)};var b=function(b,c){function d(b,c){var d="function"==typeof i.options.aboveContent?i.options.aboveContent.call(c,j.index(c),j):i.options.aboveContent,e="function"==typeof i.options.belowContent?i.options.belowContent.call(c,j.index(c),j):i.options.belowContent,f=a("<div>",{"class":"lightbox-image"}),g=a(b),h=a('<div class="loading-container"><div class="loading-indicator"></div></div>');g.attr("width",g.prop("naturalWidth")),g.attr("height",g.prop("naturalHeight")),m=a("<button>",{type:"button","class":"reset lightbox-next icon-arrow-right-small"}),l=a("<button>",{type:"button","class":"reset lightbox-prev icon-arrow-left-small"}),j.index(c)>0&&f.append(l),f.append(g.addClass("block")),j.index(c)<j.length-1&&f.append(m),l.on("click.lightbox",function(){i.prev()}),m.on("click.lightbox",function(){i.next()});var k=a("<div>",{"class":"lightbox-container"}).append(a(d),f,a(e),h);return k}function e(b,c){var d=new Image;a(d).on("load",function(){"function"==typeof c&&c.call(null,d)}),d.src=b}function f(){i.modal.element.addClass("size");var b=i.modal.element.find(".modal-container"),c=b.find(".lightbox-image img");b.css("max-width","");var d=b.outerHeight(),e=c.outerHeight(),f=c.prop("naturalWidth"),g=c.prop("naturalWidth")/c.prop("naturalHeight"),h=a(window).height()-40;if(d>h){var j=(h-(d-e))*g;b.css("max-width",Math.min(j,f)+"px")}else b.css("max-width",f+"px");i.modal.element.removeClass("size")}function g(){var c=a(this).attr("rel");return k=a(this),j=a(b+(c?'[rel="'+c+'"]':"")),i.modal=new Modal(null,{content:'<div class="loading-container"><div class="loading-indicator"></div></div>',classes:"lightbox hide-close",afterClose:h,beforeOpen:function(){this.addClass("loading")}}).open(),e(k.attr("href"),function(b){setTimeout(function(){i.modal.update(d(b,k),function(a){f(),a.removeClass("loading"),a.find(".modal-container").removeClass("hide-close")})},600),a(document).bind("keyup.lightbox",function(a){39===a.keyCode?i.next():37===a.keyCode&&i.prev()})}),!1}function h(){j=null,k=null,l.off("click.lightbox"),m.off("click.lightbox"),l=null,m=null,i.modal=null,a(document).unbind("keyup.lightbox")}var i=this,j=null,k=null,l=null,m=null;this.trigger=a(b),this.modal=null,this.options=a.extend({aboveContent:"",belowContent:""},c),this.next=function(){var a=j.index(k);if(a<j.length-1){k=j.eq(a+1);var b=setTimeout(function(){i.modal.element.addClass("loading")},200);e(k.attr("href"),function(a){i.modal.update(d(a,k),function(a){clearTimeout(b),f(),a.removeClass("loading")})})}},this.prev=function(){var a=j.index(k);if(a>0){k=j.eq(a-1);var b=setTimeout(function(){i.modal.element.addClass("loading")},200);e(k.attr("href"),function(a){i.modal.update(d(a,k),function(a){clearTimeout(b),f(),a.removeClass("loading")})})}},this.trigger.click(g),a(window).on("resize.lightbox",function(){i.modal&&f()})};window.Lightbox=b}(jQuery);